<html>
<head>

<!-- Make sure to change the title !!! -->

  <title>Sophie Pouliquen's Lab Notebook</title>
  <link rel="stylesheet" type="text/css" href="https://engineering.purdue.edu/ece477/MessageBoard/Lab_Notebook_Template.css" media="screen">

</head>
<body>

<!-- Make sure to change the name !!! -->

    <h1>Sophie Pouliquen's Lab Notebook</h1>

    <h3 id="week01">Week 01</h3>

    <p class="entry"><b>January 15, 2014 (2 hour)</b>:<br>Met as a team during lab to discuss preliminary project proposal.</p>

    <p class="entry"><b>January 15, 2014 (2.5 hours)</b>:<br>Met as a team to begin writing preliminary project proposal. I did a lot of research on existing patents and designs. </p>

    <p class="entry"><b>January 18, 2014 (3 hours)</b>:<br>Edited and completed layout for team website. </p>

    <p class="summary"><b>WEEK 01 SUMMARY</b><br>
                       <u>Accomplishments</u>: Submitted preliminary project proposal and got website up and running.<br>
                       <u>Weekly Work Total</u>: 8.5 hours<br>
                       <u>Project Work Total</u>: 8.5 hours</p>

    <h3 id="week02">Week 02</h3>

    <p class="entry"><b>January 25, 2014 (1 hour)</b>:<br>Finished cleaning up the final proposal and design schedule. All homeworks have been completed through a Google Doc form to ensure all revisions can be captured.</p>

    <p class="summary"><b>WEEK 02 SUMMARY</b><br>
                       <u>Accomplishments</u>: Submitted final project proposal<br>
                       <u>Weekly Work Total</u>: 1 hours<br>
                       <u>Project Work Total</u>: 9.5 hours</p>

    <h3 id="week03">Week 03</h3>

    <p class="entry"><b>January 28, 2014 (2 hours)</b>:<br>Completed Eagle tutorials and schematic design homework. This will be crucial to know and understand once the PCB board is being prototyped.</p>

    <p class="entry"><b>January 29, 2014 (2.5 hours)</b>:<br>Met as a team to begin prototying the Every1 DJ. Spent a few hours deciding what will be implemented and the main design aspects. It was decided that a Raspberry Pi will be used to interface with the web application. </p>

    <p class="entry"><b>February 1, 2014 (1 hour)</b>:<br>Updated Team 2 website with the PSSC's and links to the completed homeworks.</p>

    <p class="summary"><b>WEEK 03 SUMMARY</b><br>
                       <u>Accomplishments</u>: Keeping website updated and finalizing project contraints so that parts can get ordered in a timely fashion<br>
                       <u>Weekly Work Total</u>: 5.5 hours<br>
                       <u>Project Work Total</u>: 15 hours</p>

    <h3 id="week04">Week 04</h3>

    <p class="entry"><b>February 2, 2014 (1 hour)</b>:<br>Created the Google Doc for Homework 3. Did priliminary research for LED's, LCD's and microcontrollers.</p>

    <p class="entry"><b>February 4, 2014 (3 hours)</b>:<br>Finialized the design contraints for the microcontoller. Decided that around 100 I/O pins will be used for the LED's, and a shift register will not be needed to expand the I/O pins. SPI interfacing and ADC is also important to interface with the Raspberry Pi. The Every1 DJ will utilize a <a id="document_link" href="http://ww1.microchip.com/downloads/en/DeviceDoc/70616g.pdf"> DSPIC33EP512MU814-I/PH-ND </a> microntroller. 

    <br><br>Realized that heat dissipation may become an issue if all components are housed within the same unit. The system may have to utilize a fan to keep all parts cool </br></br>

    <br> Completed parts of Homework 3, including the introduction, some design contraints, interface requirements, packaging contraints, microcontroller selection and block diagram. </br>

    <br><br>Below is the block diagram for our design: </br></br>

    <img src="../images/spouliqu/BlockDiagram.png" alt="screenshot1" height="500px" width="500px"></p>

    <p class="entry"><b>February 5, 2014(1.5 hour)</b>:<br>Researched implementations of this design to see what has been used in the past. This includes packing selection, motor use, etc. The key is to determine how the disco ball and lights will be housed (i.e. a plexiglass sphere with LED's inside, a mirrored discoball with LED's on the outside, etc). Once this is finialized, parts can be ordered. </p>

    <p class="entry"><b>February 6, 2014(1.5 hour)</b>:<br>A final design was determined. LED's will be housed externally from the disco ball. This way there will be no worries of wires being tangeled. The mechanical design will mimic the design from this video: http://www.youtube.com/watch?v=Qnm_IXD6tNM . </br>

    <br> Because the mechanical design changed, and only 4 LED's will be used, the microcontroller constraints changed a little. It was determined by the team that the microcontroller needed the following properties: </br>

    <br>1. Two ADC's for audio sample</br> 
    <br>2. Around 20-40 I/O pins for LED's, LCD, push buttons</br>
    <br>3. Serial peripheral interfacing to interface with the Raspberry Pi</br>

    <br> From these specifications, and the availability of test boards in lab, it was detemined the the <a id="document_link" href="http://ww1.microchip.com/downloads/en/DeviceDoc/39778e.pdf"> PIC18F87J11 </a> would suit the projects needs the best. This device has 68 I/O pins which gives the team enough leeway incase design changes happen throughout the project. This microcontroller is also available for checkout in lab, which makes inital prototyping simpler. </br></p>

    <p class="summary"><b>WEEK 04 SUMMARY</b><br>
                       <u>Accomplishments</u>: Most parts selected and a final design selected.<br>
                       <u>Weekly Work Total</u>: 7 hours<br>
                       <u>Project Work Total</u>: 22 hours</p>

    <h3 id="week05">Week 05</h3>

    <p class="entry"><b>February 12, 2014 (1 hour)</b>:<br>Checked out the PIC microcontroller from Joe during mandatory lab session. Began downloading the software programs to begin programming the micro. Also, began looking into ordering parts for the design.</p>

    <p class="entry"><b>February 13, 2014 (1 hour)</b>:<br>Completed the commercial product packaging comparison for Homework 4. This was done by researching Walmart and Target for party lighting systems. Many of the commerical products out today have the same foundation as the Every1 DJ, but none utilize a web application for song voting.</p>

    <p class="summary"><b>WEEK 05 SUMMARY</b><br>
                       <u>Accomplishments</u>: <br>
                       <u>Weekly Work Total</u>: 2 hours<br>
                       <u>Project Work Total</u>: 24 hours</p>

    <h3 id="week06">Week 06</h3>

    <p class="entry"><b>February 16, 2014 (1 hour)</b>:<br>Began working on the pinout for the microcontroller. This has not proven very challenging yet because a lot of documentation is available for the PIC microcontroller. The difficulty is making sure all parts are connected correctly and all parts are accounted for. </p>

    <p class="entry"><b>February 19, 2014 (2.5 hours)</b>:<br>Began working the PIC18 J-Series development board. Got it connected to the PC, and loaded code onto the chip. Got the LED's to turn on and off!

 <img src="../images/spouliqu/LEDS.jpg" alt="screenshot1" height="500px" width="500px"></p> <br></p> <br>

    <p class="entry"><b>February 21, 2014 (3 hours)</b>:<br>Completed homework 5. Now there is a basic concept of how information will travel through all different parts. </p> <br>

    <p class="entry"><b>February 22, 2014 (3 hours)</b>:<br>Began working on SPI on the microcontroller. There are many examples online utilizing the LCD on the development board. These examples utilized the spi.h library but used different microcontrollers than the PIC18F87J11 that the Every1 DJ is using. Therefore, all the examples had to be re-written to utilize the correct port pins for the PIC18F87J11. About one hour was spent trying to get the premade code to work, but the LCD was displaying values that did not correspond to the written code. This may have been from previous designs loaded onto the board, and the newly written code was not being loaded correctly. <br> <br>
After this mishap, a new direction was sought. It was decided to try and get the SPI working by tying the two SPI ports together on the microcontroller. This meant having the output of SPI1 as an input to SPI2. The following port assignments were used: <br> <br>
RC3 (SCLK1) <--> RD6 (SCLK2) <br>
RC4 (SPI_IN1) <--> (SPI_OUT2) <br>
RC5 (SPI_OUT1) <--> (SPI_IN2)<br><br>
The code to send data across these ports was written, again utilizing the spi.h library. While attempting to load the design onto the development board, there were a lot of issues with the driver and updates to the driver. Until the driver setup is fixed, the code cannot be loaded onto the board. This served as a stopping point for the day after much frustration with trying to get the driver software to operate correctly. More work will be done in the next few days to try and get the driver working correctly.</p> <br>


    <p class="summary"><b>WEEK 06 SUMMARY</b><br>
                       <u>Accomplishments</u>: Work on the development board has begun. Initial SPI interfacing was started on the micrcontroller and the Raspberry Pi. Although frustrating at times, this is a very necessary step to move forward in the project. <br>
                       <u>Weekly Work Total</u>: 9.5<br>
                       <u>Project Work Total</u>: 33.5</p>

    <h3 id="week07">Week 07</h3>

    <p class="entry"><b>February 24, 2014 (2 hours)</b>:<br>More work was done to try and get SPI working on both the microcontroller and the Raspberry Pi. The driver issues were fixed by another team member before arrival. The first task was trying to get the microcontroller and the Raspberry Pi talking through SPI. An attempt was made to print out the values being sent to the Raspberry Pi, but it seemed that random variables were being read by the Raspberry Pi. This brought our focus onto SPI on the Raspberry Pi, which seemed to malfunctioning. <br> <br>
A new focus was brought on, and debugging of SPI on the Raspberry Pi was started. The SPI input, output and clock were all hooked up to the oscilloscope to verify that data was being sent correctly. While zooming in to each of the signals, it seemed that garbage values were being shown on the input and output lines. This lends to the fact that random variables were being read by the Raspberry Pi from earlier. Changes in the code utilizing the spi library were made but, it seemed that whatever code changes were made, the oscilloscope readings never changed. <br> <br>
Further work must be done to ensure SPI works on both the microcontroller and the Raspberry Pi. This is a rather frustrating step, but will prove invaluable once complete. All interfaces, except for one, utilizes SPI. Therefore, this is a top priority for all group members.  </p>

    <p class="entry"><b>February 25, 2014 (3 hours)</b>:<br> Debugged the Raspberry Pi SPI from yesterday. Instead of using the python example online from yesterday, a new c example was found. This new code tied the SPI in to the SPI out on the Raspberry Pi. Sucessful completion of data transfer occured as documented below. <br>

<a href="../images/spouliqu/RPI_SPI_Code.jpg">
	<img src="../images/spouliqu/RPI_SPI_Code.jpg" alt="rpi" height="500px" width="500px">
      </a>

<br>

<a href="../images/spouliqu/RPI_SPI.jpg">
	<img src="../images/spouliqu/RPI_SPI.jpg" alt="rpi" height="500px" width="500px">
      </a>

<br><br>
After successful completion of SPI on the Raspberry Pi, debugging between the Raspberry Pi and the microcontroller was done. The Raspberry Pi has to be set as the master to the microcontroller, because this is the only setting that is allowed on the Raspberry Pi. A successful transfer of data from the Raspberry Pi to the microcontroller was done. Pictured below shows a frequncy of 62.5 KHz matching. <br>

<a href="../images/spouliqu/SPI_Freq.jpg">
	<img src="../images/spouliqu/SPI_Freq.jpg" alt="rpi" height="500px" width="500px">
      </a>
<br>
 </p>

    <p class="entry"><b>February 26, 2014 (6 hours)</b>:<br> Created parts on Eagle including, LED driver, PIC microcontroller, voltage regualtor and voltage converter. Made sure the lengths, widths and pad size/placements were correct by placing the physical parts on a printed version of our design. Had to adjust pad lengths by ~.2mm for most of the parts so that soldering will be easier in the future. <br><br>

After all parts were created, grouping of all 'like' parts was done for the PCB layout. It is important to group 'like' parts together (ex: power, audio filtering, LED devices, etc.) so that routing is made easier. 
<br>

<a href="../images/spouliqu/Schematic.jpg">
	<img src="../images/spouliqu/Schematic.jpg" alt="rpi" height="500px" width="500px">
      </a>

</p>

    <p class="entry"><b>February 27, 2014 (2 hours)</b>:<br> Completed part placements on the PCB in Eagle. This proved to be rather difficult to try and minimize wire crossings. Also made sure that all 'like' parts were placed together, including the power circuitry, audio circuitry, LED circuitry, etc. </p>

    <p class="entry"><b>February 28, 2014 (4 hours)</b>:<br> Continued to use traces to connect parts on the PCB. Made sure to use only 45 degree angles and not cross any wires. To avoid crossed wires, holes were used to trace on the bottom side of the PCB. 
<br>

<a href="../images/spouliqu/Schematic_layout_traces.jpg">
	<img src="../images/spouliqu/Schematic_layout_traces.jpg" alt="rpi" height="500px" width="500px">
      </a>


<br><br>
    Used this time to also research a different approach to driving the motor. Instead of building a driving circuit, research into a motor driver chip was done. This would eliminate errors on the designing and selection of resistors and BJT's. The <a id="document_link" href="http://www.ti.com/lit/ds/symlink/l293d.pdf"> L293D Quadruple Half-H Driver </a> was found linked on the motor page on SparkFun. This driver works for a bipolar stepper motor, and can regulate motor direction and speed.</p>

    <p class="entry"><b>March 1, 2014 (3 hours)</b>:<br> During the first hour of this work time, updates to the team website were done. Homeworks were added in pdf format, as well as all datasheet and part documentation. It is important to have an updated website so that anyone viewing the webpage can be updated on the status of the Every1 DJ project. <br> <br>

    The remainder of this time was spent discussing the design review that will take place on Tuesday. The team divided up the talking points and discussed what would be said during the design review. An early start to slide designs was done.</p>

    <p class="summary"><b>WEEK 07 SUMMARY</b><br>
                       <u>Accomplishments</u>: Final PCB layout was complete, and all parts were placed in designated areas on the board. This is a crucial aspect of the project and must be done correctly and checked over by the TA's many times before submitting for manufacturing.<br>
                       <u>Weekly Work Total</u>: 20<br>
                       <u>Project Work Total</u>: 53.5</p>

    <h3 id="week08">Week 08</h3>

    <p class="entry"><b>March 2, 2014 (2 hours)</b>:<br> Met as a team to prepare for the design review. Split up presentation according to time lengths on each slide.</p>

    <p class="entry"><b>March 3, 2014 (4 hours)</b>:<br> Made updates on the PCB, including adding a 0 ohm resistor (which was later changed to a jumper that will be tied together) between AGND and GND, and added resitors to the LED's. 

<br><br>
Also prepared for the design review which consisted of going over slides as a team and making sure all information was covered for the presentation tomorrow. 
<br><br>
Used this time to also successfully utilize bidirectional SPI between the microcontroller and the Raspberry Pi. 

</p>

    <p class="entry"><b>March 4, 2014 (4 hours)</b>:<br> Practiced the Design Review presentation before the actual presentation this afternoon. Took all comments from the design review on Tuesday and updated the PCB accordingly. This included: <br>

1. Adding resistor to the heartbeat LED on the microcontroller <br>
2. Previously were using vias as mounting holes. Made changes to use actual mounting holes. <br>
3. Fixed the board line so all sides were straight <br>
4. Changed the inductor and capactitor parts from the SparkFun library. Made sure they were to size. <br>

<br> <br>

Added a lot of parts to the DigiKey cart to order after design review evaluations were made. This included the RJ11 connector, motor driver, new power regulators, a new power supply to allow enough current to drive the LED's, and a plastic enclosure for the base of the design. </p>

    <p class="entry"><b>March 5, 2014 (3 hours)</b>:<br> After the changes on the PCB were made, questions for George were addressed. A lot of reviews by the TA's and professors will be helpful within the next week before submitting the PCB for manufacturing. This time was also used to test the LED brightness. It came to our attention that the LED driver may not have enough output current to successfully drive the LED's. The datasheet provided showed that much more current was needed for the blue LED's to have the same luminosity as the green and red. If they are driven all at the same current, will they're be a noticable difference in brightness? Each color was tested on 100mA and they all seemed extremely bright, so it looks like they will all be driven with the same current. <br><br>

<a href="../images/spouliqu/RedLED.jpg">
	<img src="../images/spouliqu/RedLED.jpg" alt="Red" height="500px" width="500px">
      </a>
<br><br>
<a href="../images/spouliqu/GreenLED.jpg">
	<img src="../images/spouliqu/GreenLED.jpg" alt="Green" height="500px" width="500px">
      </a>
<br><br>
<a href="../images/spouliqu/BlueLED.jpg">
	<img src="../images/spouliqu/BlueLED.jpg" alt="Blue" height="500px" width="500px">
      </a>
</p>

    <p class="entry"><b>March 8, 2014 (4 hours)</b>:<br> Started looking into SPI on the LCD. A helper file is given by the manufacturer, but no explanation of the file is given. There is also not much documentation regarding the LCD. This made it extremely difficult to debug and figure out how to setup the LCD. Once all the functions were added to the project, the initialization sequence given in the spec sheet was written (as seen below). 

<br> The LCD was wired to the microcontroller to begin testing. When run the first couple of times nothing on the LCD lit up or was displayed. To debug an oscilloscope was used to make sure all the signals connecting to the LCD were set correctly. This ended our debugging for the day. 

<br><br>
<a href="../images/spouliqu/LCDCode.jpg">
	<img src="../images/spouliqu/LCDCode.jpg" alt="LCDCode" height="500px" width="500px">
      </a>

</p>

    <p class="summary"><b>WEEK 08 SUMMARY</b><br>
                       <u>Accomplishments</u>: Got a lot of great feedback from the Design Review presentation. Used this feedback to make changes to the PCB. Hopefully these will be the lasts of our revisions before final submission.<br>
                       <u>Weekly Work Total</u>: 17<br>
                       <u>Project Work Total</u>: 70.5</p>

    <h3 id="week09">Week 09</h3>

    <p class="entry"><b>March 10, 2014 (2 hours)</b>:<br> Ran into a questionable problem on the PCB. The LED drivers runs on 5V with a 3.3V logic supply. There was discussion about using a logic level translator to correct this issue. Instead, according to the data sheet, the LED's can be sunk making the LED supply voltage 5V and the LED driver voltage 3.3V. 

<br><br>
<a href="../images/spouliqu/LEDDriver.png">
	<img src="../images/spouliqu/LEDDriver.png" alt="LEDDriver" height="500px" width="500px">
      </a>
</p>

    <p class="entry"><b>March 11, 2014 (3 hours)</b>:<br> The power circuitry on the schematic was changed slightly. This includes using a stepper voltage regulator to take 12V down to 5V. An LDO is used to take 5V down to 3.3V. All the diodes were also canged to surface mount diodes. Once these changes were made, all parts were placed on the board and routing began.</p>

    <p class="entry"><b>March 12, 2014 (3 hours)</b>:<br> The final parts order was placed for all capacitors, inductors and diodes. One inductor on the PCB was out of stock online so a new inductor with similar characterisitcs was researched. Discussed the status of the PCB with the course staff and made a few minor changes based on the discussion. </p>

    <p class="entry"><b>March 13, 2014 (3 hours)</b>:<br> Did a one by one print out of the final PCB and placed all available parts on the board for sizing purposes. All of the bulk capacitors needed to be changed to correctly match the given footprints. Below is a picture of the finalized PCB with all available parts placed to fit.

<br><br>
<a href="../images/spouliqu/LCDCode.jpg">
	<img src="../images/spouliqu/PartsLayout.jpg" alt="Parts" height="500px" width="500px">
      </a>

<br><br>
<a href="../images/spouliqu/LCDCode.jpg">
	<img src="../images/spouliqu/PartsLayout2.jpg" alt="Parts" height="500px" width="500px">
      </a>
</p>

    <p class="summary"><b>WEEK 09 SUMMARY</b><br>
                       <u>Accomplishments</u>: Completed PCB design and got design reviewed by multiple TA's. The PCB was submitted to the manufacturer for development.<br>
                       <u>Weekly Work Total</u>: 9 <br>
                       <u>Project Work Total</u>: 79.5</p>


    <h3 id="week10">Week 10</h3>

    <p class="summary"><b>WEEK 10 SUMMARY</b><br>
                       <u>Accomplishments</u>: No accomplishments made this week due to Spring Break and being out of town. Will resume work when back. <br>
                       <u>Weekly Work Total</u>: 0 <br>
                       <u>Project Work Total</u>: 79.5</p>

    <h3 id="week11">Week 11</h3>

    <p class="entry"><b>March 23, 2014 (2 hours)</b>:<br> Met as a team to go over goals for the weeks and the schemdule for the rest of the semester. After, a little SPI work was continued for the RaspberryPi and microcontroller communication. </p>

    <p class="entry"><b>March 24, 2014 (3 hours)</b>:<br> Continued work on the LCD by attempting to trigger an SPI command sent from the RaspberryPi to the microcontroller to display data on the LCD. While attempting to configure this setup, a few problems arose. When scoping the clock signals for the Raspberry Pi and the microcontroller, a lot of noise was present even when both devices were not running. With some advice from the TA's, all grounds must be tied together. Had to go to the parts store to get a new header for the RaspberryPi, and will resume with the new setup tomorrow. </p>

    <p class="entry"><b>March 25, 2014 (2 hours)</b>:<br> Completed writing all ASCII characters for the lcd. This proved to be easy but time consuming because each individual character had to be written into as a 5x7 array. Still need to test whether the characters appear nicely on the lcd. Also began setup for the new Raspberry Pi and microcontroller configuration with the ribbon cable. </p>

    <p class="entry"><b>March 26, 2014 (3 hours)</b>:<br> After receving parts over Spring Break, it came to the teams attention that two parts do not fit on the PCB. The 74LVCR425 logic level translator and the LM1117 LDO were both ordered with the incorrect footprints. Research was done to find a manufacturer that sells the footprints needed in small quantities. This time was also used to discuss the solution to incorrect pin assignments on the PCB. This will either have to be solved by manually rerouting the device or a new PCB may need to be ordered. <br>
The audio circuit was also built and tested. Due to the fact that most of the parts are surface mount, wires were soldered to each pin. The op-amps did not seem to be working when connecting the audio circuit to the oscilloscope. Further digging found that the soldering may have been the cause of the broken op-amp. A work around will be to obtain a breakout board from the course staff to have the surface mounted op-amp be a through hole. </p>

    <p class="entry"><b>March 28, 2014 (3 hours)</b>:<br> Worked on completing the homework that was due this week. Discussed the possibility of using a GAL device for motor control, but was decided that the applications were already built into our PIC microcontroller.</p>

    <p class="entry"><b>March 29, 2014 (6 hours)</b>:<br> Worked on getting I^2C working on the microcontroller but no signal was able to be seen on the oscilloscope. A new task in developing the SPI communication between the Raspberry Pi and the microcontroller was done after a few hours debugging the I^2C communication with no luck. Worked on getting the ribbon cable to respond, but the oscilloscope was showing all signals as active low. Thought it might be the ribbon cable that was the issue, so a header that was hand soldered was created. Testing with the new header proved to have no impact on the active low signals. After debugging for quite a while, we decided to switch out the cable on the oscilloscope. Once changed, everything seem to work as normal. This proved to be a very frustrating day and countless hours were spent debugging this cable issue. </p>



    <p class="summary"><b>WEEK 11 SUMMARY</b><br>
                       <u>Accomplishments</u>: Started to populate the PCB with the power circuit. Ran the power circuit over night and it still works!<br>
                       <u>Weekly Work Total</u>: 19<br>
                       <u>Project Work Total</u>: 98.5</p>

    <h3 id="week12">Week 12</h3>

    <p class="entry"><b>March 30, 2014 (3 hours)</b>:<br> Began research on possible patent infringement for the Every1 DJ product. Found two patents that could be considered within infringement rights. Delved into the claim language and abstracts for multiple patents to decide whether licenses would need to be obtained if the Every1 DJ product went into manufacturing.</p>

    <p class="entry"><b>March 31, 2014 (2 hours)</b>:<br> Completed Homework 10: Legal Analysis. This homework focused on patent liability. It was surprisingly easy to find proudcts that performed the same functions as the Every1 DJ product. This could lead to possible infringment on others work. Luckily, the Every1 DJ product will not be manufactured and sold so no further steps to elimante infringement need to be taken at this time. </p>

    <p class="entry"><b>April 2, 2014 (4 hours)</b>:<br> Met for mandatory lab this morning, and spoke with the TA's about getting a new PCB because the current PCB has a few misconnected ports and there are a lot of issues with the audio circuit. It was decided that the team would continue to fly-wire the current board while the updated board is being manufactured. After this decision was made, the new audio circuit was physically tested. There were a lot of issues with the amplification, and the envelope detector was outputting a very choppy signal that would be hard to determine beats. Further testing and changes will be made to the audio circuit tomorrow. 
<br>
This time was also used to finish up I2C communication between the microcontroller and the LCD. Testing was finished on the LCD and below is a final look at some of the letters being displayed. 

<br><br>
<a href="../images/spouliqu/LCD.jpg">
	<img src="../images/spouliqu/LCD.jpg" alt="LCD" height="500px" width="800px">
      </a>
</p>

    <p class="entry"><b>April 3, 2014 (4 hours)</b>:<br> After a lot of work with Professor Meyer and a few other TA's, the amplification of the sound was working correctly. The envelope detector was still showing a very choopy signal on its output. While testing, the envelope detector was pulled. With no envelope detector, the audio signal had large peaks where the music beat was. When the potentiometer was turned, the sensitivity of the beats was higher or lower depending on the direction turned. Once a good sensitivity was determined, the circuit was created on the schematic and the PCB layout was completed. An additional header was added to the PCB for the audio circuit incase any other changes to the audio circuit needed to be done after the board was sent out for manufacturing. The current audio circuit that will be represented on the new PCB is shown below. 
<br><br>
<a href="../images/spouliqu/Audio.jpg">
	<img src="../images/spouliqu/Audio.jpg" alt="Audio" height="500px" width="800px">
      </a>

<br><br>
<a href="../images/spouliqu/AudioCircuit.jpg">
	<img src="../images/spouliqu/AudioCircuit.jpg" alt="Audio" height="500px" width="800px">
      </a>
</p>

    <p class="entry"><b>April 4, 2014 (1 hour)</b>:<br> Final changes to the PCB were made and sent to get verified. Once verification was complete, the board was submitted for manufacturing. </p>

    <p class="summary"><b>WEEK 12 SUMMARY</b><br>
                       <u>Accomplishments</u>: Completed communication between the microcontroller and LCD. The completed audio circuit was tested and verified by the team that the sensitivity of the beat detection will work for the LEDs. Finally, the new PCB design was completed and sent off for manufacturing.<br>
                       <u>Weekly Work Total</u>: 14<br>
                       <u>Project Work Total</u>: 112.5</p>

    <h3 id="week13">Week 13</h3>

    <p class="entry"><b>April 7, 2014 (2 hours)</b>:<br> Worked on soldering the LED driver and the LED's for testing purposes. Also had to order a new LDO because a 2.5V LDO was ordered instead of a 3.3V. Found a 3.3V LDO on eBay, which hopefully will arrive this week. </p>

    <p class="entry"><b>April 8, 2014 (3 hours)</b>:<br> Began prototyping with the LED driver. There was no response from the LED at first, so each individual I2C signal was scoped at the input of the LED driver. Once all correction were made to these signals, the LED dimly lit up. It was barely visible that the LED was turning on. This was debugged for a while, but no solution was made. The LED's turn on very brightly when just a power source is connected to it. <br>

Another issue with the LED driver that was discovered today, was the period of the I2C signal. The LED driver had an origional period of 500 MHz, but this was much to fast to drive any LEDs. The period was slowed down to around 10KHz so that the driver could respond to the signals it was being sent. This appeared to fix the timing issues, but there still seem to be issues with the power. 
</p>

    <p class="entry"><b>April 9, 2014 (4.5 hours)</b>:<br>Worked on trying to get the LED driver to control an LED. At first, there were no acknoledgments from the I2C protocol. This was debugged by making sure all values being sent from the microcontroller to the LED driver were correct. After reviewing the datasheet and a few online examples, it was discovered that the reset sequence being implemented was not correct. All LED port connections were not previously being reset in the correct order. Once this was fixed, acknoledgements were visible on the oscilloscope. While all the correct data seems to be sent correctly, the output of the LED is never set high and the LED never turns on. After a few hours of debugging by changing resistor values, supply voltage, etc., no luck was sought. 
<br><br>
<a href="../images/spouliqu/LEDDriverSetup1.jpg">
	<img src="../images/spouliqu/LEDDriverSetup1.jpg" alt="LEDDriver" height="500px" width="800px">
      </a>
</p>

<p class="entry"><b>April 9, 2014 (3 hours)</b>:<br> Worked on debugging of I2C on the LED's. From the signals being seen on the oscilloscope, it seemed that the driver was constantly receiving nacks and no acknowledgments were ever received. This was debugged by first making sure all grounds were connected from the microcontroller to the LED driver. Once this waws verified, there was still no changes seen in the output of the LED driver. Perhaps there are problems with the soldering job. It was decided as a team to continue this testing once the new board arrives and a new solder job is done.
</p>

<p class="entry"><b>April 10, 2014 (4 hours)</b>:<br> Worked on wiring the motor driver. The origional design for motor control did not include a PLD, which the team now thinks is necessary. A PLD was obtained from the parts room as well as a PLD programmer. The PLD code was completed using a truth table to toggle the four outputs to make the motor spin. This worked correctly, as the motor spun at variable speeds depending on how quickly the toggles occured. Fly-wiring will need to occur to implement the PLD solution since the PLD was not part of the origional PCB design. Before fly-wiring, we wanted to discuss other options that the course staff might have.<br>

We then discussed with Joe the use of a PLD in the design, even though it was not currently on the PCB. He suggested that instead of a PLD, an interrupt triggered truth table could be used. This way, no fly wiring would need to be done to attach a PLD and all code could sit on the microcontroller. The interrupt driven truth table was written, almost identical to the PLD truth table, and was tested. The motor will spin at variable speeds depending on how quickly the truth table gets set. Below is a video of the motor spinning with the use of an interrupt driven truth table. It shows that there will be enough torque to spin the disco ball in the final design. 

<br><br>
<a href="../images/spouliqu/MotorDriverSetup.jpg">
	<img src="../images/spouliqu/MotorDriverSetup.jpg" alt="LEDDriver" height="500px" width="800px">
      </a>
<br><br>
<video width="320" height="240" controls>
  <source src="../images/spouliqu/MotorSpinning.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
</p>

<p class="entry"><b>April 11, 2014 (4 hours)</b>:<br> Began testing the interrupt driven push buttons. All signals were set for the INTCON and INTCON2 registers according to the PIC18 datasheet. The pushbutton was wired with a pull down resitor and the power supply connected. When scoped, the pushbutton signal was going low when pressed and seemed to be functioning correctly. When breakpoints were added to the pushbutton interrupts, the breakpoints were never reached. The breakpoints are not registering in software, even though all signals appear to be set correctly. More debugging will begin on Sunday.</p>

    <p class="summary"><b>WEEK 13 SUMMARY</b><br>
                       <u>Accomplishments</u>: Completed design for the motor control and push buttons. It seems that allour parts are working, except the LED driver, and just need to be connected together. <br>
                       <u>Weekly Work Total</u>: 20.5<br>
                       <u>Project Work Total</u>: 133</p>

  <h3 id="week14">Week 14</h3>

    <p class="entry"><b>April 13, 2014 (4 hours)</b>:<br> Continued working on the interrupt driven push buttons. The code that was written for debugging purposes would increment a counter every time the push button was pressed. Because the counter wasn't being used anywhere else in the program, the compiler optimized the counter value out. This is why while in debug mode during pushbutton testing, it 'seemed' like the interrupts were not working correctly, but in reality they were! <br>

After the pushbutton sample code was complete, I began working on setting up the communication peripherals between the microcontroller and the Raspberry Pi. The Raspberry Pi will be sending song metadata to the microcontroller via SPI. This means that the micrcontroller needs to be interrupt driven and collect the correct metadata into the correct variables. This way, the song name, artist, album and year will be updated correctly and can be displayed on the LCD. Global variable for the song name, artist, album and year were created and a loop was created to initialize the correct data from the Raspberry Pi.</p>

    <p class="entry"><b>April 14, 2014 (6 hours)</b>:<br>The microcontroller, RJ11 connector, heart beat LED were all populated on the version 1 PCB so the microcontroller could be tested without the explorer board. Flywiring needed to be done to correct the port assignments on the microcontroller. On the current PCB, ground and power were swapped. The fly wiring corrected this mistake. Another pin was not connected when it should have been grounded, which was again corrected by flywiring. All bypass capacitors were also soldered onto the board. After all soldering and fly wiring was complete, power was added to the board and the ICD3 was connected to begin programming. <br>

MPLABX kept asserting an error about not being able to connect to the microcontroller. This led to continuity checking each connection from the RJ11 connector to the micro to verify that all soldering was done correctly. The conntinuity check was also verified against the explorer board. From the continuity check, a discovery that the RJ11 connector on the PCB was wired backwards was confirmed. After fly wiring the RJ11 connector, MPLABX showed a new error, stating that the expected ID does not match the actual ID. Further debugging will resume tomorrow. 
</p>

    <p class="entry"><b>April 15, 2014 (7 hours)</b>:<br>Used oscilloscope to capture the MCLR, Data and CLK signals from the ICD3. Saw data being sent while the MCLR was high. Checked to make sure this data was the same as the explorer board, which it was not. After this, the explorer board was scoped while unplugged from the voltage source, with just the RJ11 connector connected to 3.3V. It showed that data was still being sent even if the micro was powered off. This lead to assuming that the micro on the PCB was malfunctioning. A new microcontroller will be soldered onto a breakout board and tested tomorrow. 
</p>

    <p class="entry"><b>April 16, 2014 (3 hours)</b>:<br>A new microcontroller was soldered to a breakout board and a heart beat LED was connected to pin 1. Once the connection to ICD3 was made, the software was loaded and ran with no issues. This lead to the conclusion that the microcontroller on the PCB is dead. Version 2 of the PCB should be arriving today, and the microcontroller will be populated onto it after the power is tested over night.
</p>

    <p class="entry"><b>April 18, 2014 (4 hours)</b>:<br>The power was tested overnight with no issues on the new PCB. The microcontroller was soldered on. A few pins seemed to not be connected, but continuity checking verified that the were. A new LED was soldered on, with a 1K series resitor. The RJ11 on the breakout board from the previous PCB was used, and the connections were soldered onto the new PCB. Connected the new PCB to power and loaded the software onto it. Everything worked correctly and the heart beat LED lights up! <br>
</p>

    <p class="entry"><b>April 19, 2014 (4 hours)</b>:<br>Worked on the poster for the poster session next week. I also soldered a new header onto the PCB for the LCD connections and verified that the LCD responded correctly. One push button was also connected to test if a new page would be displayed when pressed. Below is a photo of the LCD working by displaying dummy data for the title and artist, and then when a push button is pressed, the album and year is displayed. 

<br><br>
<a href="../images/spouliqu/LCDSetup.jpg">
	<img src="../images/spouliqu/LCDSetup.jpg" alt="LCD" height="600px" width="800px">
      </a>

<br><br>
<a href="../images/spouliqu/LCDWorking.jpg">
	<img src="../images/spouliqu/LCDWorking.jpg" alt="LCD" height="600px" width="800px">
      </a>
</p>

    <p class="summary"><b>WEEK 14 SUMMARY</b><br>
                       <u>Accomplishments</u>: After a lot of debugging and a new PCB, the microcontroller is finally able to connect with the ICD3 and software is able to load onto the PCB. The heart beat LED was tested, as well as the LCD on the new PCB. Almost all parts, except the audio circuitry has been soldered and (mostly) tested. <br>
                       <u>Weekly Work Total</u>: 28<br>
                       <u>Project Work Total</u>: 161</p>

  <h3 id="week15">Week 15</h3>

    <p class="entry"><b>April 20, 2014 (3 hours)</b>:<br>Completed soldering of the LDO and the motor driver. Also removed the current male headers and soldered on new female headers to help with ease during debugging. After soldering was complete, the motor was tested. The motor was not moving, and debugging began. The output voltage of the motor driver was scoped and only around 1.4V was being driven. This is much too low to drive the motor, the motor driver should be driven at 5V. After carefully looking at the datasheet for the LDO, it seemed that it was never driving the logic from the microcontroller to the driver with 5V. The datasheet explains that the output enable pin must be set high (3.3V) with a series resitor for startup, and then also tied to a pin on the microcontroller to be set low while running. The PCB trace is currently only tied high, and therefore the OE pin will always be set high. This could be the cause of the motor issue. A consultation with the team tomorrow will verify the next steps. 
</p>

    <p class="entry"><b>April 21, 2014 (4 hours)</b>:<br> Discussed the debugging process taken yesterday with the team. It was confirmed that a the OE pin should also be tied to a pin on the microcontroller. Fly-wiring from the OE pin to the microcontroller was done so the OE signal can be set low after startup. After scoping the output voltage of the LDO, the correct 5V output was being sent to the motor driver. 
<br>
The motor was producing some strange behavior including switching directions and not being able to spin with much torque. All four connections were tested in different configurations. The fourth header pin (on the right) for the motor did not respond to any inputs after scoping. The pin from the driver was scoped and it seemed that the pin was not soldered down completly. After re-soldering the pin to the pad, the motor worked correctly with no direction switches.<br>
</p>

    <p class="entry"><b>April 22, 2014 (5 hours)</b> After testing was verified for the motor, work on the LED driver continued. The LED driver was soldered onto the new PCB, as well as twelve 10 ohm resistors connected to the outputs of the LED driver. After soldering was complete, a single LED was connected for testing. A few fixes in the initialization process were made, and the correct group brightness was set. All input signals to the LED driver were scoped and verified. The LED finally turned on and blinked once the correct group period was set. The blinking LEDs can be seen below. 
<br><br>
<video width="300" height="200" controls>
  <source src="../images/mmcmunig/LED_BLINKING.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
</p>

    <p class="entry"><b>April 25, 2014 (2 hours)</b>:<br> Populated the PCB with 10 ohm resitors on all outputs of the LED driver. Each colored LED had a different resistor value, but they were all under 15 ohms. These values were all rounded to 10 ohms. 
</p>

    <p class="summary"><b>WEEK 15 SUMMARY</b><br>
                       <u>Accomplishments</u>: Populated the PCB with the motor control circuitry. This was debugged and tested to implement full functionality of motor control. The LED's and LED driver were populated onto the new PCB and tested. After a few register configuration changes, the LED's turned on and blinked!<br>
                       <u>Weekly Work Total</u>: 14<br>
                       <u>Project Work Total</u>: 175</p>


 <h3 id="week15">Week 16</h3>

    <p class="entry"><b>April 28, 2014 (6 hours)</b>:<br> The LCD was soldered to a protoboard with long wires so that it can be mounted and connect directly to the LCD header on the PCB. The LCD was tested before mounting it to the box. Dummy data was sent to the LCD and it was displayed correctly. The heat gun was also used to attach heat shrink onto the base of the wires. This ensures that none of the wires will touch and perhaps mess up the signals on the line.
<br>
Later tonight, it was mentioned that because the LCD has multiple ground and power pins, a new protoboard would need to be added to tie these LCD connections together. I worked on soldering this new board and cuttin the origional LCD wires short so the boards could lie side by side. 
<br>
The Raspberry Pi stopped working today, and a new one was ordered. Luckily a friend was able to let the team borrow his for the time being. He also suggested we use a chip on our I/O ports from the Raspberry Pi. This chip ensures that if any part of our PCB or Raspberry Pi fails, it will not disrupt any other connecting parts. 
</p>

    <p class="entry"><b>April 29, 2014 (11 hours)</b>:<br> All four LED's were soldered with very long wires so that they can be fed through the PVC pipes and connect to the header on the PCB. Two protoboards were also soldered with power rails for the LEDs. These will be mounted to the top of the box, so all LED's can be connected to the same power coming from the PCB header. 
<br>
I began mounting the LCD with superglue and electrical tape. The hole in the box was too small to fit the LCD, so the box needed to be sanded quite a bit to increase the size of the hole. The pushbuttons were also mounted on the side of the box. Once these were all mounted to the side of the box, wiring of all parts began. All the LED, LCD and pushbutton wires were cut to the minimum length so that there would be no extra wires dangling inside the box. 
<br>
The I/O chip given to the team yesterday was soldered onto a protoboard and mounted inside the box. This was wired from the Raspberry Pi, to the Raspberry Pi connector on the PCB. 
<br>
Once all packaging was complete, the final product was tested. When all the LED's were connected to the PCB, garbage values were continually being sent across the SPI communication between the Raspberry Pi and the microcontoller. This was a huge issue, because without that communication, no song metadata could be received. This ended up being a very long night of debugging, and the only solution found was that only two LED's with one color each could be connected to run properly. This lead us to believe that there was a major power issue that for some reason was causing our LED's to not have enough current to fully run. 
</p>

    <p class="entry"><b>April 30, 2014 (5 hours)</b>: After a long night of debugging the SPI and LED issues, no progress was gained. With only two LED's utilizing one color connected to the PCB, the final PSSC video was shot. The night finally came to an end at 3:30 AM. The next morning all teams came together to view the PSSC demo videos. Team 2's video can been seen below. <br> 
<iframe width="420" height="345"
src="https://www.youtube.com/watch?v=yey6Bm6KuSc">
</iframe>
</p>

    <p class="entry"><b>May 1, 2014 (3 hours)</b>:<br> We still needed to get our final PSSC's checked off, so we hooked everything excluding the LED's to get four out of our five PSSC's checked off. After discussing the LED power issue with George Toh, he asked us what else was being powered with the LED driver 5V. The only other part that was connected to 5V is the I/O chip between the Raspberry Pi and the microcontoller. Instead of powering this chip with 5V, we fly-wired it to 3.3V and connected all the LED's back up. All LED's were powered and working correctly with no issues in the SPI communication!
</p>

    <p class="entry"><b>May 2, 2014 (5 hours)</b>: The LED PSSC was checked off and the project was officially completed! The project was brought to the design showcase to display to students and faculty. <br> 
</p>

    <p class="summary"><b>WEEK 16 SUMMARY</b><br>
                       <u>Accomplishments</u>: The final packaging was completed and all components were tested in their final state. All PSSC's were completed and checked off! The project was officially completed with success!<br>
                       <u>Weekly Work Total</u>: 30<br>
                       <u>Project Work Total</u>: 205</p>



<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	END OF NOTEBOOK SECTION, BEGIN NAVBAR.  Do not change anything beyond this point.
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
  <div id="navbar">
    <p>
      <b>DIRECTORY</b><br><br>
      <a href="#week01">Week 01</a><br>
      <a href="#week02">Week 02</a><br>
      <a href="#week03">Week 03</a><br>
      <a href="#week04">Week 04</a><br>
      <a href="#week05">Week 05</a><br>
      <a href="#week06">Week 06</a><br>
      <a href="#week07">Week 07</a><br>
      <a href="#week08">Week 08</a><br>
      <a href="#week09">Week 09</a><br>
      <a href="#week10">Week 10</a><br>
      <a href="#week11">Week 11</a><br>
      <a href="#week12">Week 12</a><br>
      <a href="#week13">Week 13</a><br>
      <a href="#week14">Week 14</a><br>
      <a href="#week15">Week 15</a><br>
      <a href="#week16">Week 16</a><br>
    </p>
  </div>
</body>
</html>

